# Airport任务调度系统开发文档

## 项目架构设计

Airport采用三级架构设计：Pipeline-Task-Step，形成清晰的层次结构，便于扩展和维护。

### 核心架构

```
Airport
├── Pipeline: 管理多个Task的执行流程
│   ├── Task 1
│   │   ├── Step 1
│   │   ├── Step 2
│   │   └── ...
│   ├── Task 2
│   └── ...
└── Remote: 处理远程服务器连接和操作
```

## 开发过程

### 1. 项目初始化
- 创建基础项目结构
- 配置TypeScript和依赖管理
- 设置测试框架vitest
- 配置ESLint和代码格式化规则

### 2. 核心组件开发

#### Step组件
- 实现Step类，支持命令执行和函数调用
- 支持多种命令格式：字符串命令、命令数组和异步函数
- 添加错误处理和日志输出

#### Task组件
- 实现Task类，管理多个Step的串行执行
- 实现任务失败时的中断机制
- 添加任务上下文传递功能

#### Pipeline组件
- 实现Pipeline类，管理多个Task的串行执行
- 添加run()和test()两种执行模式
- 实现任务执行状态跟踪

#### Remote远程功能
- 基于ssh2库实现远程服务器连接
- 支持命令执行和文件传输
- 实现多种配置方式（对象和字符串格式）

### 3. 测试策略
- 为核心组件编写单元测试
- 实现端到端测试验证完整流程
- 使用mock隔离外部依赖

## 架构决策记录

### 为什么选择三级架构而非二级架构？
Pipeline-Task-Step三级架构相比直接使用Task-Step二级架构提供了更好的抽象层次，使复杂流程更易于管理和维护。这种设计允许用户组合不同的任务集，实现更复杂的工作流。

### 为什么选择ssh2而非其他远程执行库？
ssh2库提供了完整的SSH协议实现，支持命令执行、文件传输和端口转发等功能，比简单的exec命令更强大，且支持密钥认证，安全性更高<mcreference link="https://github.com/mscdex/ssh2" index=